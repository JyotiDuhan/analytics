$(function(){console.log("Jyoti Duhan")}),$(".wrap").on("click",function(){var t=$(".slctn").is(":visible")?!0:!1;t?$(".slctn").hide():$(".slctn").show()});var store=[];$(".slctn").on("click",".chk",function(){if($self=$(this),$self.is(":checked"))store.push($self.next().html()),$("#y-option").val($self.next().html());else{var t=store.indexOf($self.next().html());store.splice(t,1),$("#y-option").val("")}});var startDate,endDate,y,data={},flag;$(".submit").on("click",function(){$(".focus")&&$(".focus").empty(),data.startDate=$("#datepicker-start").val(),data.endDate=$("#datepicker-end").val(),data.y=store,$.ajax({url:"/fetchData",data:{data:data},cache:"false",success:function(t){function a(t){for(var a,e={mean:0,variance:0,deviation:0},n=t.length,r=0,i=n;i--;r+=parseInt(t[i].price));for(a=e.mean=r/n,i=n,r=0;i--;r+=Math.pow(parseInt(t[i].price)-a,2));return e.deviation=Math.sqrt(e.variance=r/n),e}for(var e={top:10,right:10,bottom:100,left:40},n=500-e.left-e.right,r=300-e.top-e.bottom,i=d3.time.format("%b %Y").parse,o=["#27ae60","#B3A681"],s=d3.time.scale().range([0,800]),c=d3.scale.linear().range([r,0]),d=d3.svg.axis().scale(s).orient("bottom"),l=d3.svg.axis().scale(c).orient("left"),p=d3.select("body").append("svg").attr("width",n+e.left+e.right+500).attr("height",r+e.top+e.bottom+100),f=p.append("g").attr("class","focus").attr("transform","translate("+e.left+","+e.top+")"),m=$.map(JSON.parse(t),function(t,a){return[t]}),u=0;u<m.length;u++){var h=m[u];h.forEach(function(t){t.date=i(t.date),t.price=t.price})}s.domain(d3.extent(m[0].map(function(t){return t.date}))),c.domain([0,d3.max(m[0].map(function(t){return t.price}))]),f.append("g").attr("class","x axis").attr("transform","translate(0,"+r+")").call(d),f.append("g").attr("class","y axis").call(l);for(var v=0;v<m.length;v++){var t=m[v],g=d3.svg.line().interpolate("monotone").x(function(t){return s(t.date)}).y(function(t){return c(t.price)});f.append("path").datum(t).attr("class","line").attr("stroke",o[v]).attr("d",g);var x=a(t),k=[{date:t[0].date,price:x.mean},{date:t[t.length-1].date,price:x.mean}],y=d3.svg.line().x(function(t){return s(t.date)}).y(function(t){return c(t.price)});f.append("path").datum(k).attr("class","meanline").attr("d",y);var b=[{date:t[0].date,price:x.mean-x.deviation},{date:t[t.length-1].date,price:x.mean-x.deviation}];f.append("path").datum(b).attr("class","sdline min").attr("d",y).attr("stroke",o[v]);var D=[{date:t[0].date,price:x.mean+x.deviation},{date:t[t.length-1].date,price:x.mean+x.deviation}];f.append("path").datum(D).attr("class","sdline max").attr("d",y).attr("stroke",o[v])}},error:function(t){console.log(t)}})});